# Kuro Siwo æ´ªæ°´æ£€æµ‹é¡¹ç›® - æ–‡ä»¶ç»“æ„è¯¦è§£

## ğŸ¯ é¡¹ç›®æ¦‚è¿°
**ä¼šè®®ï¼š** NeurIPS 2024
**ä»»åŠ¡ï¼š** åŸºäºSentinel-1 SARå«æ˜Ÿå½±åƒçš„å…¨çƒæ´ªæ°´è‡ªåŠ¨æ£€æµ‹
**æ•°æ®è§„æ¨¡ï¼š** 33äº¿å¹³æ–¹ç±³æ´ªæ°´è¦†ç›–åŒºåŸŸ
**æ¨¡å‹æ•°é‡ï¼š** 12+ æ·±åº¦å­¦ä¹ æ¨¡å‹

---

## ğŸ“ å®Œæ•´æ–‡ä»¶ç›®å½•æ ‘

```
flood/
â”‚
â”œâ”€â”€ ğŸ¬ å…¥å£æ–‡ä»¶
â”‚   â””â”€â”€ main.py                          # ä¸»ç¨‹åºå…¥å£ï¼ˆ196è¡Œï¼‰
â”‚
â”œâ”€â”€ ğŸ“š æ–‡æ¡£
â”‚   â”œâ”€â”€ README.md                        # è‹±æ–‡é¡¹ç›®è¯´æ˜ï¼ˆ87è¡Œï¼‰
â”‚   â”œâ”€â”€ é¡¹ç›®ç»“æ„è¯¦ç»†è¯´æ˜.md              # ä¸­æ–‡è¯¦ç»†æ–‡æ¡£ï¼ˆ798è¡Œï¼‰
â”‚   â””â”€â”€ PROJECT_STRUCTURE.md             # æœ¬æ–‡ä»¶ï¼ˆç®€æ´ç‰ˆç»“æ„è¯´æ˜ï¼‰
â”‚
â”œâ”€â”€ âš™ï¸ é…ç½®ä¸ä¾èµ–
â”‚   â”œâ”€â”€ requirements.txt                 # Pythonä¾èµ–åŒ…åˆ—è¡¨
â”‚   â”œâ”€â”€ LICENSE                          # MITå¼€æºåè®®
â”‚   â””â”€â”€ .pre-commit-config.yaml          # ä»£ç æ ¼å¼åŒ–é…ç½®ï¼ˆBlackï¼‰
â”‚
â”œâ”€â”€ ğŸ’¾ æ•°æ®ä¸‹è½½
â”‚   â””â”€â”€ download_kuro_siwo.sh           # æ•°æ®é›†ä¸‹è½½è„šæœ¬ï¼ˆ95è¡ŒBashï¼‰
â”‚
â”œâ”€â”€ ğŸ“Š catalogue/                        # æ•°æ®ç›®å½•ç®¡ç†
â”‚   â”œâ”€â”€ catalogue.py                     # å…ƒæ•°æ®è§£æå™¨
â”‚   â””â”€â”€ catalogue.yaml                   # æ´ªæ°´äº‹ä»¶å…ƒæ•°æ®åº“
â”‚
â”œâ”€â”€ âš™ï¸ configs/                          # é…ç½®æ–‡ä»¶å¤¹
â”‚   â”œâ”€â”€ config.json                      # å…¨å±€é…ç½®
â”‚   â”œâ”€â”€ grd_preprocessing.xml           # SAR GRDæ•°æ®é¢„å¤„ç†é…ç½®
â”‚   â”œâ”€â”€ slc_preprocessing.xml           # SAR SLCæ•°æ®é¢„å¤„ç†é…ç½®
â”‚   â”‚
â”‚   â”œâ”€â”€ augmentations/
â”‚   â”‚   â””â”€â”€ augmentation.json           # æ•°æ®å¢å¼ºå‚æ•°
â”‚   â”‚
â”‚   â”œâ”€â”€ loss/
â”‚   â”‚   â””â”€â”€ focal.json                  # Focal Lossé…ç½®
â”‚   â”‚
â”‚   â”œâ”€â”€ method/                         # æ¨¡å‹é…ç½®ï¼ˆ12ä¸ªæ¨¡å‹ï¼‰
â”‚   â”‚   â”œâ”€â”€ unet/unet.json
â”‚   â”‚   â”œâ”€â”€ snunet/snunet.json          # â­ æœ€ä½³æ¨¡å‹ (F1=0.85)
â”‚   â”‚   â”œâ”€â”€ changeformer/changeformer.json
â”‚   â”‚   â”œâ”€â”€ bit-cd/bit_cd.json
â”‚   â”‚   â”œâ”€â”€ siam-conc/siam_conc.json
â”‚   â”‚   â”œâ”€â”€ siam-diff/siam_diff.json
â”‚   â”‚   â”œâ”€â”€ hfa-net/hfa_net.json
â”‚   â”‚   â”œâ”€â”€ adhr-cdnet/adhr_cdnet.json
â”‚   â”‚   â”œâ”€â”€ transunet-cd/transunet_cd.json
â”‚   â”‚   â”œâ”€â”€ convlstm/convlstm.json
â”‚   â”‚   â”œâ”€â”€ mae/mae.json
â”‚   â”‚   â”œâ”€â”€ deeplabv3/deeplabv3.json
â”‚   â”‚   â””â”€â”€ upernet/upernet.json
â”‚   â”‚
â”‚   â””â”€â”€ train/
â”‚       â”œâ”€â”€ train_config.json           # è®­ç»ƒè¶…å‚æ•°
â”‚       â””â”€â”€ data_config.json            # æ•°æ®é›†é…ç½®ï¼ˆæ•°æ®åˆ’åˆ†ã€é€šé“è®¾ç½®ï¼‰
â”‚
â”œâ”€â”€ ğŸ—‚ï¸ dataset/
â”‚   â””â”€â”€ Dataset.py                      # PyTorchæ•°æ®é›†ç±»ï¼ˆ1238è¡Œï¼‰â­æ ¸å¿ƒ
â”‚
â”œâ”€â”€ ğŸ§  models/                           # æ·±åº¦å­¦ä¹ æ¨¡å‹å®ç°
â”‚   â”œâ”€â”€ model_utilities.py              # æ¨¡å‹å·¥å‚ï¼ˆ237è¡Œï¼‰
â”‚   â”œâ”€â”€ unet.py                         # U-Net
â”‚   â”œâ”€â”€ snunet.py                       # SNUNet-CDï¼ˆ152è¡Œï¼‰â­æœ€ä½³
â”‚   â”œâ”€â”€ changeformer.py                 # Transformerå˜åŒ–æ£€æµ‹ï¼ˆ675è¡Œï¼‰
â”‚   â”œâ”€â”€ bit_cd.py                       # äºŒå€¼å›¾åƒTransformerï¼ˆ934è¡Œï¼‰
â”‚   â”œâ”€â”€ siam_conc.py                    # å­ªç”Ÿç½‘ç»œ-æ‹¼æ¥ï¼ˆ177è¡Œï¼‰
â”‚   â”œâ”€â”€ siam_diff.py                    # å­ªç”Ÿç½‘ç»œ-å·®åˆ†ï¼ˆ172è¡Œï¼‰
â”‚   â”œâ”€â”€ hfanet.py                       # å±‚æ¬¡ç‰¹å¾èšåˆï¼ˆ655è¡Œï¼‰
â”‚   â”œâ”€â”€ adhr_cdnet.py                   # ADHRå˜åŒ–æ£€æµ‹ï¼ˆ576è¡Œï¼‰
â”‚   â”œâ”€â”€ transunet_cd.py                 # TransUNetå˜åŒ–æ£€æµ‹ï¼ˆ312è¡Œï¼‰
â”‚   â”œâ”€â”€ convlstm.py                     # å¾ªç¯LSTMï¼ˆ226è¡Œï¼‰
â”‚   â”œâ”€â”€ upernet.py                      # UPerNetï¼ˆ90è¡Œï¼‰
â”‚   â”œâ”€â”€ mae.py                          # æ©ç è‡ªç¼–ç å™¨ï¼ˆ124è¡Œï¼‰
â”‚   â””â”€â”€ vision_transformer.py           # Vision Transformeréª¨å¹²ï¼ˆ156è¡Œï¼‰
â”‚
â”œâ”€â”€ ğŸ‹ï¸ training/                        # è®­ç»ƒæµç¨‹
â”‚   â”œâ”€â”€ segmentation_trainer.py         # è¯­ä¹‰åˆ†å‰²è®­ç»ƒå™¨ï¼ˆ1011è¡Œï¼‰â­æ ¸å¿ƒ
â”‚   â”œâ”€â”€ change_detection_trainer.py     # å˜åŒ–æ£€æµ‹è®­ç»ƒå™¨ï¼ˆ792è¡Œï¼‰
â”‚   â”œâ”€â”€ recurrent_trainer.py            # å¾ªç¯ç½‘ç»œè®­ç»ƒå™¨ï¼ˆ764è¡Œï¼‰
â”‚   â””â”€â”€ train_mae.py                    # MAEè‡ªç›‘ç£è®­ç»ƒï¼ˆ232è¡Œï¼‰
â”‚
â”œâ”€â”€ ğŸ”§ utilities/                        # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ utilities.py                    # é€šç”¨å·¥å…·ï¼ˆ422è¡Œï¼‰
â”‚   â”œâ”€â”€ augmentations.py                # æ•°æ®å¢å¼ºæµæ°´çº¿ï¼ˆ42è¡Œï¼‰
â”‚   â”œâ”€â”€ bce_and_dice.py                 # BCE+Diceç»„åˆæŸå¤±ï¼ˆ23è¡Œï¼‰
â”‚   â””â”€â”€ dice.py                         # Dice Losså®ç°ï¼ˆ149è¡Œï¼‰
â”‚
â”œâ”€â”€ ğŸ–¼ï¸ imgs/
â”‚   â””â”€â”€ kuro_spatial.png                # æ•°æ®é›†åœ°ç†åˆ†å¸ƒå¯è§†åŒ–
â”‚
â”œâ”€â”€ ğŸ“‘ json/                             # SLCæ•°æ®ç´¢å¼•ï¼ˆå¯é€‰ï¼‰
â”‚   â”œâ”€â”€ slc_grid_pwater_0.0001.json
â”‚   â””â”€â”€ slc_grid_pwater_0.json
â”‚
â””â”€â”€ ğŸ—œï¸ pickle/                          # GRDæ•°æ®ç´¢å¼•ï¼ˆæ¨èï¼‰
    â”œâ”€â”€ KuroV2_grid_dict.gz             # è®­ç»ƒæ•°æ®ç´¢å¼•
    â””â”€â”€ KuroV2_grid_dict_test_0_100.gz  # æµ‹è¯•æ•°æ®ç´¢å¼•
```

---

## ğŸ”‘ æ ¸å¿ƒæ–‡ä»¶è¯¦è§£

### 1ï¸âƒ£ [main.py](main.py) - ç¨‹åºå…¥å£
**ä½œç”¨ï¼š** æ•´ä¸ªé¡¹ç›®çš„æŒ‡æŒ¥ä¸­å¿ƒ

**ä¸»è¦åŠŸèƒ½ï¼š**
- è§£æå‘½ä»¤è¡Œå‚æ•°ï¼ˆæ¨¡å‹é€‰æ‹©ã€æ‰¹æ¬¡å¤§å°ç­‰ï¼‰
- åŠ è½½æ‰€æœ‰é…ç½®æ–‡ä»¶
- åˆ›å»ºæ•°æ®åŠ è½½å™¨ï¼ˆè®­ç»ƒ/éªŒè¯/æµ‹è¯•é›†ï¼‰
- åˆå§‹åŒ–æ¨¡å‹
- è°ƒç”¨è®­ç»ƒå™¨å¼€å§‹è®­ç»ƒ
- è¯„ä¼°æ¨¡å‹æ€§èƒ½

**è¾“å…¥ï¼š** å‘½ä»¤è¡Œå‚æ•°
```bash
python main.py --method=snunet --batch_size=32 --dem=True
```

**è¾“å‡ºï¼š**
- è®­ç»ƒå¥½çš„æ¨¡å‹ï¼ˆä¿å­˜åœ¨ `checkpoints/` ç›®å½•ï¼‰
- è®­ç»ƒæ—¥å¿—ï¼ˆç»ˆç«¯è¾“å‡º + WandBäº‘ç«¯ï¼‰
- æµ‹è¯•æŒ‡æ ‡ï¼ˆIoU, F1åˆ†æ•°ç­‰ï¼‰

**è°ƒç”¨å…³ç³»ï¼š**
```
main.py
  â†’ utilities.prepare_loaders()  # å‡†å¤‡æ•°æ®
  â†’ model_utilities.initialize_*_model()  # åˆå§‹åŒ–æ¨¡å‹
  â†’ training/*_trainer.py  # å¼€å§‹è®­ç»ƒ
```

---

### 2ï¸âƒ£ [dataset/Dataset.py](dataset/Dataset.py) - æ•°æ®åŠ è½½æ ¸å¿ƒï¼ˆ1238è¡Œï¼‰â­
**ä½œç”¨ï¼š** PyTorchæ•°æ®é›†ç±»ï¼Œè´Ÿè´£è¯»å–å’Œå¤„ç†SARå›¾åƒ

**ä¸»è¦åŠŸèƒ½ï¼š**
1. **åˆå§‹åŒ–é˜¶æ®µ**ï¼š
   - ä»pickle/jsonæ–‡ä»¶åŠ è½½æ•°æ®ç´¢å¼•
   - æ ¹æ®æ¿€æ´»IDç­›é€‰è®­ç»ƒ/éªŒè¯/æµ‹è¯•é›†
   - è®¡ç®—æ•°æ®ç»Ÿè®¡é‡ï¼ˆå‡å€¼/æ–¹å·®ç”¨äºå½’ä¸€åŒ–ï¼‰
   - å¤„ç†ç±»åˆ«ä¸å¹³è¡¡ï¼ˆè¿‡é‡‡æ ·æ´ªæ°´æ ·æœ¬ï¼‰

2. **æ•°æ®è¯»å–ï¼ˆ`__getitem__`ï¼‰**ï¼š
   - è¯»å–å¤šé€šé“.tifæ–‡ä»¶ï¼ˆVVã€VHã€DEMç­‰ï¼‰
   - åŠ è½½æ ‡æ³¨æ©ç ï¼ˆGNDæ–‡ä»¶ï¼‰
   - æ•°æ®å½’ä¸€åŒ–
   - åº”ç”¨æ•°æ®å¢å¼ºï¼ˆè®­ç»ƒæ—¶ï¼‰
   - è¿”å›PyTorchå¼ é‡

**è¾“å…¥ï¼š**
- ç´¢å¼•æ–‡ä»¶ï¼š`pickle/KuroV2_grid_dict.gz`
- å›¾åƒæ–‡ä»¶ï¼š`data/act_XXX/aoi_XX/grid_XXXXX/*.tif`

**è¾“å‡ºå¼ é‡å½¢çŠ¶ï¼š**
```python
# è¯­ä¹‰åˆ†å‰²
image:  torch.Tensor([batch, 2, 224, 224])  # 2é€šé“ï¼šVV+VH
label:  torch.Tensor([batch, 224, 224])     # åƒç´ çº§æ ‡æ³¨ï¼ˆ0/1/2ï¼‰

# å˜åŒ–æ£€æµ‹
pre_image:   torch.Tensor([batch, 2, 224, 224])
post_image:  torch.Tensor([batch, 2, 224, 224])
label:       torch.Tensor([batch, 224, 224])
```

**ç±»åˆ«å®šä¹‰ï¼š**
- 0: é™†åœ°ï¼ˆæ— æ°´ï¼‰
- 1: æ°¸ä¹…æ°´ä½“ï¼ˆæ¹–æ³Šã€æ²³æµã€æµ·æ´‹ï¼‰
- 2: æ´ªæ°´åŒºåŸŸï¼ˆæ–°å‡ºç°çš„æ°´ï¼‰

---

### 3ï¸âƒ£ [models/model_utilities.py](models/model_utilities.py) - æ¨¡å‹å·¥å‚ï¼ˆ237è¡Œï¼‰
**ä½œç”¨ï¼š** æ ¹æ®é…ç½®æ–‡ä»¶åˆ›å»ºå¯¹åº”çš„æ·±åº¦å­¦ä¹ æ¨¡å‹

**ä¸»è¦å‡½æ•°ï¼š**

**`initialize_segmentation_model(config, model_configs)`**
- åˆ›å»ºè¯­ä¹‰åˆ†å‰²æ¨¡å‹ï¼ˆU-Net, DeepLabV3ç­‰ï¼‰
- åŠ è½½ImageNeté¢„è®­ç»ƒæƒé‡

**`initialize_cd_model(config, model_configs)`**
- åˆ›å»ºå˜åŒ–æ£€æµ‹æ¨¡å‹ï¼ˆSNUNet, ChangeFormerç­‰ï¼‰
- å¤„ç†åŒå›¾åƒè¾“å…¥æ¶æ„

**`initialize_recurrent_model(configs, model_configs)`**
- åˆ›å»ºå¾ªç¯ç¥ç»ç½‘ç»œï¼ˆConvLSTMï¼‰
- å¤„ç†æ—¶åºå›¾åƒåºåˆ—

**è¾“å…¥ï¼š**
- `configs/config.json`
- `configs/method/{method}/{method}.json`

**è¾“å‡ºï¼š**
- åˆå§‹åŒ–å¥½çš„PyTorchæ¨¡å‹å¯¹è±¡

**ç¤ºä¾‹ä»£ç ï¼š**
```python
# main.pyä¸­è°ƒç”¨
model = initialize_cd_model(configs, model_configs)
# è¿”å›ï¼šSNUNet_ECAM(in_channels=2, out_channels=3)
```

---

### 4ï¸âƒ£ [models/snunet.py](models/snunet.py) - æœ€ä½³æ¨¡å‹ï¼ˆ152è¡Œï¼‰â­
**ä½œç”¨ï¼š** SNUNet-CDæ¨¡å‹å®ç°ï¼ˆè®ºæ–‡ä¸­F1=0.85çš„æœ€ä½³æ¨¡å‹ï¼‰

**æ¶æ„ç‰¹ç‚¹ï¼š**
- **å­ªç”Ÿç¼–ç å™¨**ï¼šå…±äº«æƒé‡å¤„ç†æ´ªæ°´å‰åå›¾åƒ
- **å¯†é›†è·³è·ƒè¿æ¥**ï¼šåµŒå¥—U-Netç»“æ„
- **é€šé“æ³¨æ„åŠ›æœºåˆ¶ï¼ˆECAMï¼‰**ï¼šèšç„¦å˜åŒ–åŒºåŸŸ
- **5ä¸ªåˆ†è¾¨ç‡å±‚çº§**ï¼šå¤šå°ºåº¦ç‰¹å¾æå–

**è¾“å…¥ï¼š**
```python
xA: torch.Tensor([batch, 2, 224, 224])  # æ´ªæ°´å‰å›¾åƒ
xB: torch.Tensor([batch, 2, 224, 224])  # æ´ªæ°´åå›¾åƒ
```

**è¾“å‡ºï¼š**
```python
output: torch.Tensor([batch, 3, 224, 224])  # 3ç±»åˆ†å‰²æ©ç 
```

**ç½‘ç»œç»“æ„ï¼š**
```
è¾“å…¥A/B â†’ å…±äº«ç¼–ç å™¨ â†’ ç‰¹å¾èåˆï¼ˆECAMæ³¨æ„åŠ›ï¼‰ â†’ å¯†é›†è§£ç å™¨ â†’ è¾“å‡º
   â†“                      â†“                           â†“
 224Ã—224              56Ã—56                       224Ã—224
```

**å‚è€ƒæ–‡çŒ®ï¼š** Fang et al., "SNUNet-CD: A Densely Connected Siamese Network for Change Detection", IEEE GRSL 2022

---

### 5ï¸âƒ£ [training/segmentation_trainer.py](training/segmentation_trainer.py) - è®­ç»ƒæ ¸å¿ƒï¼ˆ1011è¡Œï¼‰â­
**ä½œç”¨ï¼š** è¯­ä¹‰åˆ†å‰²æ¨¡å‹çš„è®­ç»ƒå’Œè¯„ä¼°æµç¨‹

**ä¸»è¦å‡½æ•°ï¼š**

**`train_semantic_segmentation(...)`**
- å®Œæ•´çš„è®­ç»ƒå¾ªç¯
- æ”¯æŒæ··åˆç²¾åº¦è®­ç»ƒï¼ˆFP16åŠ é€Ÿï¼‰
- è‡ªåŠ¨ä¿å­˜æœ€ä½³æ¨¡å‹
- WandBå®éªŒè·Ÿè¸ª
- æ—©åœæœºåˆ¶

**`eval_semantic_segmentation(...)`**
- æµ‹è¯•é›†è¯„ä¼°
- è®¡ç®—å¤šé¡¹æŒ‡æ ‡ï¼šIoUã€F1ã€ç²¾ç¡®ç‡ã€å¬å›ç‡
- åˆ†AOIï¼ˆåŒºåŸŸï¼‰ç»Ÿè®¡
- åˆ†æ°”å€™å¸¦ç»Ÿè®¡
- ç”Ÿæˆæ··æ·†çŸ©é˜µ

**è®­ç»ƒæµç¨‹ï¼š**
```python
for epoch in range(epochs):
    # è®­ç»ƒé˜¶æ®µ
    for batch in train_loader:
        output = model(batch['image'])
        loss = criterion(output, batch['label'])
        loss.backward()
        optimizer.step()

    # éªŒè¯é˜¶æ®µ
    val_metrics = evaluate(model, val_loader)

    # ä¿å­˜æœ€ä½³æ¨¡å‹
    if val_metrics['iou'] > best_iou:
        save_checkpoint(model, 'best_segmentation.pt')
```

**è¾“å…¥ï¼š**
- æ¨¡å‹å¯¹è±¡
- æ•°æ®åŠ è½½å™¨ï¼ˆtrain/val/testï¼‰
- é…ç½®å­—å…¸

**è¾“å‡ºï¼š**
- è®­ç»ƒå¥½çš„æ¨¡å‹æ£€æŸ¥ç‚¹ï¼š`checkpoints/snunet/RandomEvents_20231215/best_segmentation.pt`
- è®­ç»ƒæ›²çº¿ï¼ˆlossã€IoUéšepochå˜åŒ–ï¼‰
- æµ‹è¯•é›†æ€§èƒ½æŒ‡æ ‡

---

### 6ï¸âƒ£ [configs/train/data_config.json](configs/train/data_config.json) - æ•°æ®é…ç½®â­
**ä½œç”¨ï¼š** å®šä¹‰æ•°æ®é›†åˆ’åˆ†å’Œé¢„å¤„ç†å‚æ•°

**å…³é”®å­—æ®µï¼š**

```json
{
  "train_acts": [130, 470, 555, ...],  // 27ä¸ªè®­ç»ƒæ´ªæ°´äº‹ä»¶
  "val_acts": [514, 559, 279, ...],    // 7ä¸ªéªŒè¯æ´ªæ°´äº‹ä»¶
  "test_acts": [321, 561, 445, ...],   // 10ä¸ªæµ‹è¯•æ´ªæ°´äº‹ä»¶

  "inputs": [
    "pre_event_1",   // æ´ªæ°´å‰1å‘¨
    "pre_event_2",   // æ´ªæ°´å‰2å‘¨
    "post_event"     // æ´ªæ°´æ—¶
  ],

  "channels": ["vv", "vh"],  // SARæåŒ–é€šé“

  "data_mean": [0.0953, 0.0264],  // VV/VHå‡å€¼ï¼ˆå½’ä¸€åŒ–ç”¨ï¼‰
  "data_std": [0.0427, 0.0215],   // VV/VHæ ‡å‡†å·®

  "dem": true,      // æ˜¯å¦åŒ…å«é«˜ç¨‹æ•°æ®
  "slope": false    // æ˜¯å¦åŒ…å«å¡åº¦æ•°æ®
}
```

**æ•°æ®åˆ’åˆ†åŸåˆ™ï¼š**
- âœ… æ¿€æ´»IDä¸¥æ ¼åˆ†ç¦»ï¼ˆæ— æ•°æ®æ³„éœ²ï¼‰
- âœ… è¦†ç›–ä¸åŒæ°”å€™å¸¦ï¼ˆ1=çƒ­å¸¦, 2=å¹²æ—±, 3=æ¸©å¸¦, 4=å¯’å¸¦, 5=æåœ°ï¼‰
- âœ… è®­ç»ƒé›†æœ€å¤§åŒ–ï¼š27ä¸ªäº‹ä»¶ï¼ˆçº¦70%ï¼‰

---

### 7ï¸âƒ£ [utilities/utilities.py](utilities/utilities.py) - å·¥å…·å‡½æ•°é›†ï¼ˆ422è¡Œï¼‰
**ä½œç”¨ï¼š** æä¾›è®­ç»ƒè¿‡ç¨‹ä¸­éœ€è¦çš„å„ç§è¾…åŠ©å‡½æ•°

**æ ¸å¿ƒå‡½æ•°ï¼š**

**`prepare_loaders(configs)`**
- åˆ›å»ºPyTorchæ•°æ®åŠ è½½å™¨
- è¿”å›ï¼štrain_loader, val_loader, test_loader

**`create_checkpoint_directory(configs, model_configs)`**
- åˆ›å»ºæ¨¡å‹ä¿å­˜è·¯å¾„
- ç¤ºä¾‹ï¼š`checkpoints/snunet/RandomEvents_20231215/`

**`initialize_metrics(configs, mode='train')`**
- åˆ›å»ºè¯„ä¼°æŒ‡æ ‡å¯¹è±¡ï¼ˆtorchmetricsï¼‰
- è¿”å›ï¼šAccuracy, F1Score, IoUç­‰

**`create_loss(configs, mode='train')`**
- æŸå¤±å‡½æ•°å·¥å‚
- æ”¯æŒï¼šCrossEntropy, Focal, Dice, BCE+Dice

**`init_lr_scheduler(optimizer, configs, model_configs, steps)`**
- å­¦ä¹ ç‡è°ƒåº¦å™¨
- æ”¯æŒï¼šä½™å¼¦é€€ç«ã€é˜¶æ¢¯è¡°å‡ã€ReduceLROnPlateau

**`update_config(configs, args)`**
- åˆå¹¶å‘½ä»¤è¡Œå‚æ•°å’Œé…ç½®æ–‡ä»¶
- è‡ªåŠ¨è°ƒæ•´è¾“å…¥é€šé“æ•°ï¼ˆDEM/Slopeå¼€å¯æ—¶ï¼‰

---

### 8ï¸âƒ£ [catalogue/catalogue.yaml](catalogue/catalogue.yaml) - æ´ªæ°´äº‹ä»¶å…ƒæ•°æ®åº“
**ä½œç”¨ï¼š** è®°å½•æ¯ä¸ªæ´ªæ°´æ¿€æ´»äº‹ä»¶çš„è¯¦ç»†ä¿¡æ¯

**ç¤ºä¾‹æ¡ç›®ï¼š**
```yaml
- act_id: 470              # æ¿€æ´»ID
  act_region: Togo         # åœ°ç†ä½ç½®ï¼ˆå¤šå“¥ï¼‰
  ref_date: 20201005T180000  # æ´ªæ°´å‘ç”Ÿæ—¶é—´
  aois:                    # å…´è¶£åŒºåˆ—è¡¨
    - aoi_id: '01'
      aoi_name: Oti River  # å¥¥è’‚æ²³
      cl_zone: 1           # æ°”å€™å¸¦ï¼š1=çƒ­å¸¦
```

**æ°”å€™å¸¦ç¼–ç ï¼š**
- 1: çƒ­å¸¦ï¼ˆTropicalï¼‰
- 2: å¹²æ—±ï¼ˆAridï¼‰
- 3: æ¸©å¸¦ï¼ˆTemperateï¼‰
- 4: å¯’å¸¦ï¼ˆColdï¼‰
- 5: æåœ°ï¼ˆPolarï¼‰

**ç”¨é€”ï¼š**
- æ•°æ®é›†å…ƒæ•°æ®ç®¡ç†
- åˆ†åŒºåŸŸæ€§èƒ½è¯„ä¼°
- æ°”å€™å¸¦æ³›åŒ–æ€§åˆ†æ

---

## ğŸ”„ æ•°æ®æµå›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·å‘½ä»¤                                               â”‚
â”‚  python main.py --method=snunet --batch_size=32        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  main.py                                               â”‚
â”‚  1. è§£æå‚æ•°                                            â”‚
â”‚  2. åŠ è½½configs/                                        â”‚
â”‚  3. åˆ›å»ºcheckpoints/ç›®å½•                                â”‚
â”‚  4. è°ƒç”¨utilities.prepare_loaders()                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼               â–¼               â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ configs â”‚    â”‚utilitiesâ”‚    â”‚catalogueâ”‚
   â”‚ *.json  â”‚    â”‚         â”‚    â”‚.yaml    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                       â”‚               â”‚
                       â–¼               â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ utilities.prepare_loaders() â”‚
              â”‚ åˆ›å»ºDatasetå®ä¾‹              â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ dataset/Dataset.py          â”‚
              â”‚ 1. åŠ è½½pickleç´¢å¼•            â”‚
              â”‚ 2. ç­›é€‰æ¿€æ´»ID                â”‚
              â”‚ 3. __getitem__: è¯».tifæ–‡ä»¶  â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ æ•°æ®å¼ é‡                     â”‚
              â”‚ image:  [32, 2, 224, 224]   â”‚
              â”‚ label:  [32, 224, 224]      â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼               â–¼               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Model  â”‚    â”‚ Trainer  â”‚    â”‚ Metrics  â”‚
    â”‚(snunet)â”‚    â”‚(seg/cd)  â”‚    â”‚(F1, IoU) â”‚
    â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
        â”‚              â”‚               â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ è®­ç»ƒå¾ªç¯                     â”‚
              â”‚ 1. å‰å‘ä¼ æ’­                  â”‚
              â”‚ 2. è®¡ç®—æŸå¤±                  â”‚
              â”‚ 3. åå‘ä¼ æ’­                  â”‚
              â”‚ 4. æ›´æ–°æƒé‡                  â”‚
              â”‚ 5. éªŒè¯å¹¶ä¿å­˜æœ€ä½³æ¨¡å‹        â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ checkpoints/                â”‚
              â”‚ snunet/best_segmentation.pt â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¥ æ•°æ®æ–‡ä»¶å‘½åè§„åˆ™

### æ¯ä¸ªgridï¼ˆ224Ã—224åƒç´ å›¾å—ï¼‰åŒ…å«çš„æ–‡ä»¶ï¼š

```
data/act_130/aoi_01/grid_00001/
â”œâ”€â”€ MS1_IVV.tif    # æ´ªæ°´æ—¶VVæåŒ–ï¼ˆMaster Imageï¼‰
â”œâ”€â”€ MS1_IVH.tif    # æ´ªæ°´æ—¶VHæåŒ–
â”œâ”€â”€ SL1_IVV.tif    # æ´ªæ°´å‰1å‘¨VVï¼ˆSlave 1ï¼‰
â”œâ”€â”€ SL1_IVH.tif    # æ´ªæ°´å‰1å‘¨VH
â”œâ”€â”€ SL2_IVV.tif    # æ´ªæ°´å‰2å‘¨VVï¼ˆSlave 2ï¼‰
â”œâ”€â”€ SL2_IVH.tif    # æ´ªæ°´å‰2å‘¨VH
â”œâ”€â”€ MK0_GND.tif    # æ ‡æ³¨æ©ç ï¼ˆGround Truthï¼‰
â”œâ”€â”€ MK0_MNA.tif    # æœ‰æ•ˆåƒç´ æ©ç ï¼ˆMask Validï¼‰
â”œâ”€â”€ MK0_DEM.tif    # æ•°å­—é«˜ç¨‹æ¨¡å‹ï¼ˆå¯é€‰ï¼‰
â””â”€â”€ MK0_SLP.tif    # å¡åº¦ï¼ˆå¯é€‰ï¼‰
```

**æ–‡ä»¶åè§£æï¼š**
- `MS1` = Master Slave 1ï¼ˆä¸»å›¾åƒï¼‰
- `SL1/SL2` = Slave 1/2ï¼ˆå‚è€ƒå›¾åƒï¼‰
- `IVV/IVH` = Intensity VV/VHï¼ˆæåŒ–å¼ºåº¦ï¼‰
- `MK0` = Mask 0
- `GND` = Ground Truthï¼ˆçœŸå€¼æ ‡æ³¨ï¼‰
- `MNA` = Mask Not Availableï¼ˆæ©ç ï¼‰
- `DEM` = Digital Elevation Modelï¼ˆé«˜ç¨‹ï¼‰
- `SLP` = Slopeï¼ˆå¡åº¦ï¼‰

---

## âš™ï¸ ä½¿ç”¨ç¤ºä¾‹

### è®­ç»ƒSNUNetæ¨¡å‹ï¼š
```bash
# åŸºç¡€è®­ç»ƒ
python main.py --method=snunet --batch_size=32

# æ·»åŠ DEMå’Œå¡åº¦ç‰¹å¾
python main.py --method=snunet --batch_size=32 --dem --slope

# ä½¿ç”¨ç‰¹å®šGPU
python main.py --method=snunet --gpu=0

# ä»æ£€æŸ¥ç‚¹æ¢å¤è®­ç»ƒ
python main.py --method=snunet --resume_checkpoint=checkpoints/snunet/.../best.pt
```

### æµ‹è¯•é¢„è®­ç»ƒæ¨¡å‹ï¼š
```bash
python main.py --method=snunet --test --resume_checkpoint=path/to/model.pt
```

### è®­ç»ƒå…¶ä»–æ¨¡å‹ï¼š
```bash
# U-Net (ResNet18éª¨å¹²)
python main.py --method=unet --backbone=resnet18

# ChangeFormer (Transformer)
python main.py --method=changeformer

# DeepLabV3+
python main.py --method=deeplabv3 --backbone=resnet50
```

---

## ğŸ¯ æ¨¡å‹æ€§èƒ½å¯¹æ¯”ï¼ˆè®ºæ–‡æ•°æ®ï¼‰

| æ¨¡å‹ | F1åˆ†æ•° | IoU | é€Ÿåº¦ | å¤æ‚åº¦ |
|------|--------|-----|------|--------|
| FloodViT (MAE) | 0.87 | 0.78 | æ…¢ | é«˜ |
| **SNUNet** â­ | **0.85** | **0.76** | **ä¸­** | **ä¸­** |
| ChangeFormer | 0.83 | 0.74 | æ…¢ | é«˜ |
| U-Net (ResNet50) | 0.81 | 0.71 | å¿« | ä¸­ |
| Siam-Conc | 0.78 | 0.67 | å¿« | ä½ |

**æ¨èï¼š**
- **ç»¼åˆæœ€ä½³ï¼š** SNUNetï¼ˆç²¾åº¦ä¸é€Ÿåº¦å¹³è¡¡ï¼‰
- **æœ€é«˜ç²¾åº¦ï¼š** FloodViTï¼ˆéœ€MAEé¢„è®­ç»ƒï¼‰
- **æœ€å¿«é€Ÿåº¦ï¼š** U-Netï¼ˆè½»é‡çº§éª¨å¹²ï¼‰

---

## ğŸ—‘ï¸ å·²åˆ é™¤çš„å†—ä½™æ–‡ä»¶

### âŒ NULï¼ˆç©ºæ–‡ä»¶ï¼‰
- **çŠ¶æ€ï¼š** å·²åˆ é™¤
- **åŸå› ï¼š** Windowså‘½ä»¤è¡Œé‡å®šå‘é”™è¯¯äº§ç”Ÿçš„ç©ºæ–‡ä»¶
- **å½±å“ï¼š** æ— 

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. è®¸å¯è¯çŸ›ç›¾
- `LICENSE` æ–‡ä»¶ï¼šMIT License
- `README.md` æ–‡æ¡£ï¼šCC BY Licenseï¼ˆç”¨äºæ•°æ®é›†ï¼‰
- **å»ºè®®ï¼š** ä»£ç ç”¨MITï¼Œæ•°æ®é›†ç”¨CC BY

### 2. å¯é€‰æ–‡ä»¶ï¼ˆä¿ç•™ä½†ä¸å¸¸ç”¨ï¼‰
- `configs/grd_preprocessing.xml` / `configs/slc_preprocessing.xml`
  - ç”¨äºSNAPè½¯ä»¶é¢„å¤„ç†åŸå§‹Sentinel-1æ•°æ®
  - ä¸‹è½½çš„æ•°æ®é›†å·²é¢„å¤„ç†å®Œæˆï¼Œæ™®é€šç”¨æˆ·ä¸éœ€è¦

- `json/` ç›®å½•ï¼ˆSLCæ•°æ®ç´¢å¼•ï¼‰
  - ä»…å½“ä½¿ç”¨SLCé«˜åˆ†è¾¨ç‡æ•°æ®æ—¶éœ€è¦
  - æ¨èä½¿ç”¨GRDæ•°æ®ï¼ˆæ›´ç®€å•ï¼‰

### 3. ç¼ºå¤±åŠŸèƒ½
- âŒ æ— ç‹¬ç«‹æ¨ç†è„šæœ¬ï¼ˆéœ€è‡ªå·±å†™ï¼‰
- âŒ æ— æ•°æ®å¯è§†åŒ–å·¥å…·ï¼ˆéœ€è‡ªå·±å®ç°ï¼‰
- âŒ æ— å•å…ƒæµ‹è¯•

---

## ğŸ“š å¼•ç”¨æœ¬é¡¹ç›®

```bibtex
@inproceedings{kurosiwo2024,
  title={Kuro Siwo: 33 billion $m^2$ under the water. A global multi-temporal satellite dataset for rapid flood mapping},
  author={Your Authors},
  booktitle={Advances in Neural Information Processing Systems (NeurIPS)},
  year={2024}
}
```

---

## ğŸ“ è·å–å¸®åŠ©

- **GitHub Issuesï¼š** [é¡¹ç›®ä»“åº“é“¾æ¥]
- **æ•°æ®é›†ä¸‹è½½ï¼š** è¿è¡Œ `./download_kuro_siwo.sh`
- **è¯¦ç»†æ–‡æ¡£ï¼š** é˜…è¯» [é¡¹ç›®ç»“æ„è¯¦ç»†è¯´æ˜.md](é¡¹ç›®ç»“æ„è¯¦ç»†è¯´æ˜.md)

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v1.0
**æœ€åæ›´æ–°ï¼š** 2024-12
**ç»´æŠ¤è€…ï¼š** Kuro Siwoå›¢é˜Ÿ
